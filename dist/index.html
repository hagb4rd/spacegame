<html>
<head>
<title>spacegame</title>
<script src="../webkit/webkit.min.js"></script>
<script src="vector.js"></script>
<style>
* {
    margin: 0;
    padding: 0;
}
html {
    background-color: #023;
    color: #eee;
}
canvas {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    margin: auto;
    width: 100%;
    height: 100%;
}
</style>    
</head>
<body>
<canvas></canvas> 
<script>
var canvas=document.querySelector('canvas');
var ctx=canvas.getContext('2d');
var screen = {
    width: window.innerWidth,
    height: window.innerHeight,
    center: [window.innerWidth/2,window.innerHeight/2],
    zoom: 1
}
var mouse = {
    absolute: [0,0],
    relative: [0,0],
    angle: 0,
    update([x,y]){
      this.absolute=[x,y];
      this.relative=Vector.subtract(this.absolute,screen.center);
      //this.angle=(this.relative.angle+Math.PI/2)%(Math.PI*2);
      this.angle=(Vector.angle(this.relative)+Math.PI/2)%(Math.PI*2);
    },
    draw(){
      ctx.font = '14pt Arial';
      ctx.strokeStyle = 'red';
      ctx.strokeText(`x: ${this.relative[0]} y: ${this.relative[1]} angle: ${deg(this.angle).toFixed(1)}`, 14, 14);
    }   
}
resize();

var actors = [];




var ship = {
    pos: [0,0],
    angle: 0,
    scale: 3,
    velocity: [0,0],
    model: {
        vertex:[[0,10],[7,-5],[0,-2],[-7,-5]],
        lines:[
            [0,1,2,3,0]
        ]
    },
    update() {
      this.pos=screen.center;
      this.angle=mouse.angle;
    },
    draw() {
      var mirrorY = this.model.vertex.map(([x,y])=>[x,-y]);
      var scaled=mirrorY.map(vertex=>Vector.scale(this.scale,vertex)); 
      var rotationMatrix=Matrix.rotation2D(this.angle);
      var rotated=scaled.map(vertex=>rotationMatrix.multiplicate(vertex));
      var translated=rotated.map(vertex=>Vector.add(vertex, this.pos));
      

      this.model.lines.forEach(line => {
        ctx.beginPath();
        ctx.lineWidth = "2";
        ctx.strokeStyle = "green";
        var [x,y]=translated[line[0]];
        ctx.moveTo(x,y);
        line.slice(1).map(i=>translated[i]).forEach(([x,y])=>{
          ctx.lineTo(x,y);
        });
        ctx.stroke();
      })



    }
}
var projectionMatrix = () => new Matrix([
  [zoom, 0, (screen.center[0]+ship.pos[0])*zoom],
  [0, -zoom, (screen.center[1]+ship.pos[1])*zoom],
  [0, 0, zoom]
])


loop();


function loop() {
  ctx.clearRect(0, 0, screen.width, screen.height);
  mouse.draw();
  ship.update();
  ship.draw();
  requestAnimationFrame(loop);
}


function touch(e) {
  var {pageX:x, pageY:y} = e.originalEvent.touches[0];
  mouse.update([x,y]);
}

function mousemove(e) {
  var {pageX:x, pageY:y} = e;
  mouse.update([x,y]);
}

function resize() {
  screen.width = canvas.width = window.innerWidth;
  screen.height = canvas.height = window.innerHeight;
  screen.center = [window.innerWidth/2,window.innerHeight/2];
}

window.addEventListener('resize', resize);
window.addEventListener('touchstart', touch);
window.addEventListener('touchmove', touch);
window.addEventListener('mousemove', mousemove);

</script>
</body>
</html>